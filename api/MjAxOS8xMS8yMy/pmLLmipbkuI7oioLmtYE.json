{"title":"前端防抖与节流","date":"2019-11-23T14:32:03.781Z","date_formatted":{"ll":"2019年11月23日","L":"2019/11/23","MM-DD":"11-23"},"link":"2019/11/23/防抖与节流","tags":["性能优化"],"categories":["front-end"],"updated":"2019-11-24T12:20:06.180Z","content":"<h4 id=\"代码引用掘金文章\"><a href=\"https://juejin.im/post/5c87b54ce51d455f7943dddb#chapter-one\" target=\"_blank\" rel=\"noopener\">代码引用掘金文章</a><a href=\"2019/11/23/防抖与节流#代码引用掘金文章\"></a></h4><hr>\n<blockquote>\n<h4 id=\"何为防抖-debounce\"><a href=\"2019/11/23/防抖与节流#何为防抖-debounce\" class=\"headerlink\" title=\"何为防抖(debounce)\"></a><strong>何为防抖(debounce)</strong></h4><p>防抖就是在某个时间段，发送了无数次请求，但最终只执行最后的 一次请求操作，以最少的请求达到性能优化的目的。</p>\n<p>解决方法:</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>防抖<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"debounce\"</span>&gt;</span>点我防抖！<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"comment\">// 1、获取这个按钮，并绑定事件</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> myDebounce = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"debounce\"</span>);</span></span><br><span class=\"line\"><span class=\"actionscript\">        myDebounce.addEventListener(<span class=\"string\">\"click\"</span>, debounce(sayDebounce));</span></span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"comment\">// 2、防抖功能函数，接受传参</span></span></span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span><span class=\"params\">(fn)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"comment\">// 4、创建一个标记用来存放定时器的返回值</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> timeout = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 5、每次当用户点击/输入的时候，把前一个定时器清除</span></span></span><br><span class=\"line\">          clearTimeout(timeout);</span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 6、然后创建一个新的 setTimeout，</span></span></span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 这样就能保证点击按钮后的 interval 间隔内</span></span></span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 如果用户还点击了的话，就不会执行 fn 函数</span></span></span><br><span class=\"line\"><span class=\"javascript\">          timeout = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            fn.call(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span></span><br><span class=\"line\">          &#125;, 1000);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"comment\">// 3、需要进行防抖的事件处理</span></span></span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayDebounce</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"comment\">// ... 有些需要防抖的工作，在这里执行</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"防抖成功！\"</span>);</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</blockquote>\n<hr>\n<blockquote>\n<h4 id=\"何为节流-throttle\"><a href=\"2019/11/23/防抖与节流#何为节流-throttle\" class=\"headerlink\" title=\"何为节流(throttle)\"></a><strong>何为节流(throttle)</strong></h4><p>节流就是每隔一段时间，执行一次函数。</p>\n<p>解决方法:</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>节流<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"throttle\"</span>&gt;</span>点我节流！<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">      <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"comment\">// 1、获取按钮，绑定点击事件</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">var</span> myThrottle = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"throttle\"</span>);</span></span><br><span class=\"line\"><span class=\"actionscript\">        myThrottle.addEventListener(<span class=\"string\">\"click\"</span>, throttle(sayThrottle));</span></span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"comment\">// 2、节流函数体</span></span></span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span><span class=\"params\">(fn)</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"comment\">// 4、通过闭包保存一个标记</span></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> canRun = <span class=\"literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"actionscript\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 5、在函数开头判断标志是否为 true，不为 true 则中断函数</span></span></span><br><span class=\"line\">          if (!canRun) &#123;</span><br><span class=\"line\"><span class=\"actionscript\">            <span class=\"keyword\">return</span>;</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 6、将 canRun 设置为 false，防止执行之前再被执行</span></span></span><br><span class=\"line\"><span class=\"actionscript\">          canRun = <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"actionscript\">          <span class=\"comment\">// 7、定时器</span></span></span><br><span class=\"line\"><span class=\"javascript\">          setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            fn.call(<span class=\"keyword\">this</span>, <span class=\"built_in\">arguments</span>);</span></span><br><span class=\"line\"><span class=\"actionscript\">            <span class=\"comment\">// 8、执行完事件（比如调用完接口）之后，重新将这个标志设置为 true</span></span></span><br><span class=\"line\"><span class=\"actionscript\">            canRun = <span class=\"literal\">true</span>;</span></span><br><span class=\"line\">          &#125;, 1000);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"comment\">// 3、需要节流的事件</span></span></span><br><span class=\"line\"><span class=\"actionscript\">      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayThrottle</span><span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"节流成功！\"</span>);</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n</blockquote>\n","prev":{"title":"前端防抖与节流2","link":"2019/11/24/防抖与节流2"},"next":{"title":"Hello hexo","link":"2019/11/23/hello-world"},"plink":"https://another-404.github.io/2019/11/23/防抖与节流/"}